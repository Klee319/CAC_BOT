# Google Forms連携セットアップガイド

## エラー「Google Formsへのアクセス権限が不足しています」の解決方法

### 1. Google Cloud Console の設定

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. プロジェクトを選択（GOOGLE_PROJECT_IDに設定したプロジェクト）
3. 「APIとサービス」→「ライブラリ」に移動
4. 「Google Forms API」を検索して有効化

### 2. サービスアカウントの設定確認

1. Google Cloud Console で「IAMと管理」→「サービスアカウント」に移動
2. 使用中のサービスアカウント（GOOGLE_CLIENT_EMAILに設定したアカウント）を確認
3. キーが正しく設定されていることを確認

### 3. Google Formsでの共有設定

**重要**: 各Google Formsでサービスアカウントにアクセス権限を付与する必要があります。

1. 対象のGoogle Formsを開く
2. 右上の「送信」ボタンをクリック
3. 「共同編集者を追加」または「設定」→「共同編集者」
4. BOTのサービスアカウントのメールアドレス（GOOGLE_CLIENT_EMAIL）を追加
5. 権限を「編集者」または「閲覧者」に設定

### 4. 代替方法：フォームをパブリックにする

1. Google Formsで「設定」（歯車アイコン）をクリック
2. 「回答」タブで「回答を制限する」のチェックを外す
3. 「全般」タブで適切な共有設定を行う

### 5. 確認方法

フォーム作成を再試行して、エラーが解消されるか確認してください。

## トラブルシューティング

### エラーが続く場合

1. Google Cloud Consoleで「APIとサービス」→「認証情報」を確認
2. サービスアカウントキーを再生成
3. 環境変数（GOOGLE_CLIENT_EMAIL, GOOGLE_PRIVATE_KEY）を更新
4. BOTを再起動

### 制限事項

- Google Forms APIでフォームを編集するには、フォームの所有者または編集者権限が必要
- BOTが自動的に必須フィールドを追加する場合、フォームへの編集権限が必要
- 読み取り専用権限では、フォーム情報の取得と回答の収集のみ可能

## 必須フィールドについて

BOTは以下の必須フィールドを自動的に追加しようとします：
- **名前**: 氏名を入力してください（例: 山田太郎）
- **学籍番号**: 学籍番号を入力してください（例: 2024001）
- **Discordユーザー名**: Discordのユーザー名を入力してください（例: username#1234）

### 自動追加が失敗する場合

編集権限が不足している場合は、手動でこれらのフィールドを追加してください。