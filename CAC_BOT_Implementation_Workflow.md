# CAC BOT 実装ワークフロー・タスク管理シート

## 概要
このドキュメントは、CAC BOTの実装を効率的に進めるためのタスク管理シートです。
各フェーズごとに必要なタスクを定義し、依存関係を明確にしています。

## 全体スケジュール（推定）
- **総工数**: 約80-100時間
- **推奨期間**: 3-4週間（パートタイム開発を想定）

## フェーズ1: プロジェクト初期設定（8時間）

### 1.1 開発環境構築（2時間）
- [ ] Node.js 20.x LTSのインストール確認
- [ ] プロジェクトディレクトリの作成
- [ ] Git リポジトリの初期化
- [ ] .gitignoreの設定

### 1.2 依存関係のセットアップ（2時間）
- [ ] package.jsonの作成
- [ ] TypeScript設定（tsconfig.json）
- [ ] 必要なnpmパッケージのインストール
  - [ ] discord.js v14
  - [ ] googleapis
  - [ ] sqlite3
  - [ ] dotenv
  - [ ] node-cron
  - [ ] winston
  - [ ] zod
- [ ] 開発用パッケージのインストール
  - [ ] @types/node
  - [ ] typescript
  - [ ] nodemon
  - [ ] eslint関連

### 1.3 基本構造の作成（2時間）
- [ ] ディレクトリ構造の作成
- [ ] 環境変数テンプレート（.env.example）の作成
- [ ] 基本的な設定ファイル（config.json）の作成

### 1.4 外部サービス設定（2時間）
- [ ] Discord Developer PortalでBOT作成
- [ ] BOTの必要な権限設定
- [ ] Google Cloud Consoleでプロジェクト作成
- [ ] Google Sheets API有効化
- [ ] サービスアカウント作成と認証情報取得

## フェーズ2: コア機能の実装（24時間）

### 2.1 BOT基盤構築（8時間）
- [ ] メインBOTファイル（index.ts）の作成
- [ ] Discord.js クライアントの初期化
- [ ] イベントハンドラーシステムの実装
- [ ] コマンドハンドラーシステムの実装
- [ ] エラーハンドリングの基本実装
- [ ] ログシステムの実装（Winston）

### 2.2 データベース層の実装（4時間）
- [ ] SQLiteデータベースの初期化
- [ ] データベーススキーマの作成
  - [ ] members テーブル
  - [ ] votes テーブル
  - [ ] settings テーブル
  - [ ] audit_logs テーブル
- [ ] データベース操作用のサービスクラス作成

### 2.3 Google API連携（8時間）
- [ ] Google認証の実装
- [ ] Sheets APIクライアントの作成
- [ ] スプレッドシート読み取り機能
- [ ] スプレッドシート書き込み機能
- [ ] データ同期サービスの実装
- [ ] エラーハンドリングとリトライ機能

### 2.4 設定管理システム（4時間）
- [ ] config.json読み込み機能
- [ ] 動的設定更新機能
- [ ] 設定バリデーション（zod）
- [ ] 設定変更の監視機能

## フェーズ3: 部員管理機能（16時間）

### 3.1 部員データモデル（2時間）
- [ ] Member インターフェースの実装
- [ ] データバリデーション
- [ ] データ変換ユーティリティ

### 3.2 自動登録システム（6時間）
- [ ] guildMemberAddイベントハンドラー
- [ ] DMでの登録案内送信
- [ ] Google Forms連携の実装
- [ ] 登録完了通知システム
- [ ] エラーハンドリング

### 3.3 部員管理コマンド（8時間）
- [ ] /member register コマンド
- [ ] /member update コマンド
- [ ] /member delete コマンド
- [ ] /member list コマンド
- [ ] /member search コマンド
- [ ] /member grade-up コマンド
- [ ] 各コマンドの権限チェック

## フェーズ4: 部費管理機能（8時間）

### 4.1 部費管理コマンド（6時間）
- [ ] /fee check コマンド
- [ ] /fee update コマンド
- [ ] /fee unpaid コマンド
- [ ] CSV出力機能

### 4.2 部費通知機能（2時間）
- [ ] 未納者リマインド機能
- [ ] 定期実行設定（node-cron）

## フェーズ5: 投票・アンケート機能（16時間）

### 5.1 Google Forms連携（8時間）
- [ ] Forms API読み取り実装
- [ ] フォーム構造の解析
- [ ] Discord UIへの変換ロジック
  - [ ] テキスト入力 → モーダル
  - [ ] 選択肢 → セレクトメニュー
  - [ ] 複数選択 → マルチセレクト
- [ ] 画像表示対応

### 5.2 投票システム（8時間）
- [ ] /vote create コマンド
- [ ] /vote edit コマンド
- [ ] /vote list コマンド
- [ ] /vote response コマンド
- [ ] /vote close コマンド
- [ ] /vote results コマンド
- [ ] 回答データの保存
- [ ] 匿名投票機能

## フェーズ6: 通知・ログシステム（8時間）

### 6.1 通知システム（4時間）
- [ ] 通知サービスの実装
- [ ] 各種通知テンプレート
- [ ] 通知設定の管理
- [ ] スケジュール実行

### 6.2 ログ・監査システム（4時間）
- [ ] ファイルログ出力
- [ ] Discordチャンネルへのログ送信
- [ ] 監査ログの記録
- [ ] ログローテーション

## フェーズ7: セキュリティ・権限管理（4時間）
- [ ] ロールベース権限チェック
- [ ] コマンド実行権限の実装
- [ ] チャンネル制限機能
- [ ] レート制限の実装

## フェーズ8: テスト・デバッグ（12時間）

### 8.1 単体テスト（4時間）
- [ ] 各サービスクラスのテスト
- [ ] ユーティリティ関数のテスト
- [ ] モックデータの作成

### 8.2 統合テスト（4時間）
- [ ] コマンドの動作確認
- [ ] Google API連携テスト
- [ ] エラーケースのテスト

### 8.3 ユーザー受け入れテスト（4時間）
- [ ] 実際の利用シナリオでのテスト
- [ ] パフォーマンステスト
- [ ] バグ修正

## フェーズ9: デプロイ・運用準備（4時間）

### 9.1 デプロイ準備（2時間）
- [ ] プロダクションビルドの作成
- [ ] 環境変数の設定
- [ ] デプロイスクリプトの作成

### 9.2 ドキュメント作成（2時間）
- [ ] README.mdの作成
- [ ] 運用マニュアルの作成
- [ ] トラブルシューティングガイド

## 実装の優先順位

### 必須機能（MVP）
1. BOT基盤とGoogle Sheets連携
2. 基本的な部員管理（登録・更新・一覧）
3. 部費確認機能
4. 基本的な通知機能

### 追加機能（フェーズ2）
1. 高度な検索機能
2. 投票・アンケート機能
3. 自動登録システム
4. 詳細なログ機能

## リスクと対策

### 技術的リスク
- **Google Forms API制限**: 読み取り専用のため、フォーム作成は手動
- **対策**: 明確な運用手順書の作成

### 運用リスク
- **データ不整合**: スプレッドシートの手動編集による問題
- **対策**: 定期的なデータ検証機能の実装

## 成功基準
- [ ] すべての必須コマンドが正常に動作する
- [ ] Google Sheetsとの同期が安定している
- [ ] エラー発生時に適切に処理される
- [ ] 管理者が容易に設定変更できる
- [ ] ドキュメントが充実している

---

このワークフローに従って実装を進めることで、計画的かつ効率的にCAC BOTを完成させることができます。