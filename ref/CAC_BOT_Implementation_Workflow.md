# CAC BOT 実装ワークフロー・タスク管理シート

## 概要
このドキュメントは、CAC BOTの実装を効率的に進めるためのタスク管理シートです。
各フェーズごとに必要なタスクを定義し、依存関係を明確にしています。

## 全体スケジュール（推定）
- **総工数**: 約84-104時間（GoogleForm連携機能追加により4時間増加）
- **推奨期間**: 3-4週間（パートタイム開発を想定）

## フェーズ1: プロジェクト初期設定（8時間）

### 1.1 開発環境構築（2時間）
- [x] Node.js 20.x LTSのインストール確認
- [x] プロジェクトディレクトリの作成
- [x] Git リポジトリの初期化
- [x] .gitignoreの設定

### 1.2 依存関係のセットアップ（2時間）
- [x] package.jsonの作成
- [x] TypeScript設定（tsconfig.json）
- [x] 必要なnpmパッケージのインストール
  - [x] discord.js v14
  - [x] googleapis
  - [x] sqlite3
  - [x] dotenv
  - [x] node-cron
  - [x] winston
  - [x] zod
  - [x] uuid（GoogleForm連携で追加）
- [x] 開発用パッケージのインストール
  - [x] @types/node
  - [x] typescript
  - [x] nodemon
  - [x] eslint関連

### 1.3 基本構造の作成（2時間）
- [x] ディレクトリ構造の作成
- [x] 環境変数テンプレート（.env.example）の作成
- [x] 基本的な設定ファイル（config.json）の作成

### 1.4 外部サービス設定（2時間）
- [x] Discord Developer PortalでBOT作成
- [x] BOTの必要な権限設定
- [x] Google Cloud Consoleでプロジェクト作成
- [x] Google Sheets API有効化
- [x] Google Forms API有効化（新規追加）
- [x] サービスアカウント作成と認証情報取得

## フェーズ2: コア機能の実装（24時間）

### 2.1 BOT基盤構築（8時間）
- [x] メインBOTファイル（index.ts）の作成
- [x] Discord.js クライアントの初期化
- [x] イベントハンドラーシステムの実装
- [x] コマンドハンドラーシステムの実装
- [x] エラーハンドリングの基本実装
- [x] ログシステムの実装（Winston）

### 2.2 データベース層の実装（4時間）
- [x] SQLiteデータベースの初期化
- [x] データベーススキーマの作成
  - [x] members テーブル
  - [x] google_forms テーブル
  - [x] form_responses テーブル
  - [x] settings テーブル
  - [x] audit_logs テーブル
  - [x] security_events テーブル
  - [x] sync_metadata テーブル
- [x] データベース操作用のサービスクラス作成

### 2.3 Google API連携（8時間）
- [x] Google認証の実装
- [x] Sheets APIクライアントの作成
- [x] Forms APIクライアントの作成
- [x] スプレッドシート読み取り機能
- [x] スプレッドシート書き込み機能
- [x] データ同期サービスの実装
- [x] エラーハンドリングとリトライ機能

### 2.4 設定管理システム（4時間）
- [x] config.json読み込み機能
- [x] 動的設定更新機能
- [x] 設定バリデーション（zod）
- [x] 設定変更の監視機能

## フェーズ3: 部員管理機能（16時間）

### 3.1 部員データモデル（2時間）
- [x] Member インターフェースの実装
- [x] データバリデーション
- [x] データ変換ユーティリティ

### 3.2 自動登録システム（6時間）
- [x] guildMemberAddイベントハンドラー
- [x] DMでの登録案内送信
- [x] Google Forms連携の実装
- [x] 登録完了通知システム
- [x] エラーハンドリング

### 3.3 部員管理コマンド（8時間）
- [x] /member register コマンド
- [x] /member update コマンド
- [x] /member delete コマンド
- [x] /member list コマンド
- [x] /member search コマンド
- [x] /member grade-up コマンド
- [x] 各コマンドの権限チェック

## フェーズ4: 部費管理機能（8時間）

### 4.1 部費管理コマンド（6時間）
- [x] /fee check コマンド
- [x] /fee update コマンド
- [x] /fee unpaid コマンド
- [x] CSV出力機能

### 4.2 部費通知機能（2時間）
- [x] 未納者リマインド機能
- [x] 定期実行設定（node-cron）



## フェーズ8: テスト・デバッグ（12時間）

### 8.1 単体テスト（4時間）
- [ ] 各サービスクラスのテスト
- [ ] ユーティリティ関数のテスト
- [ ] モックデータの作成

### 8.2 統合テスト（4時間）
- [ ] コマンドの動作確認
- [ ] Google API連携テスト
- [ ] エラーケースのテスト

### 8.3 ユーザー受け入れテスト（4時間）
- [ ] 実際の利用シナリオでのテスト
- [ ] パフォーマンステスト
- [ ] バグ修正

## フェーズ9: デプロイ・運用準備（4時間）

### 9.1 デプロイ準備（2時間）
- [ ] プロダクションビルドの作成
- [ ] 環境変数の設定
- [ ] デプロイスクリプトの作成

### 9.2 ドキュメント作成（2時間）
- [ ] README.mdの作成
- [ ] 運用マニュアルの作成
- [ ] トラブルシューティングガイド

## 実装の優先順位

### 必須機能（MVP）
1. BOT基盤とGoogle Sheets連携
2. 基本的な部員管理（登録・更新・一覧）
3. 部費確認機能
4. 基本的な通知機能

### 追加機能（フェーズ2）
1. GoogleForm連携機能
2. 高度な検索機能
3. 自動登録システム
4. 詳細なログ機能

## リスクと対策

### 技術的リスク
- **Google Forms API制限**: 一日の作成数制限、レート制限
- **対策**: 適切なリトライ機能の実装、使用量の監視
- **フォーム削除制限**: APIでの削除機能なし
- **対策**: 運用ガイドラインの作成、手動削除手順の明記

### 運用リスク
- **データ不整合**: スプレッドシートの手動編集による問題
- **対策**: 定期的なデータ検証機能の実装

## 成功基準
- [ ] すべての必須コマンドが正常に動作する
- [ ] Google Sheetsとの同期が安定している
- [ ] エラー発生時に適切に処理される
- [ ] 管理者が容易に設定変更できる
- [ ] ドキュメントが充実している

---

このワークフローに従って実装を進めることで、計画的かつ効率的にCAC BOTを完成させることができます。